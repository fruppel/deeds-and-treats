import{g as z,a as J,b as K,c as V,f as y,d as N,e as F}from"./formatting-service-CQyrWaM7.js";import{m as U,n as x,k as f,o,e as s,p as Q,t as r,q as $,F as S,s as L,a as T,i as a,r as O,c as M,l as R,v as X,f as i,w as u,_ as Y,x as Z,y as ee,z as te,A as se,g as _}from"./app-fm232Leb.js";import{u as G}from"./deeds-B22SkmIc.js";import{u as ae}from"./treats-dqNdb7dL.js";import{u as ne}from"./inpayments-DIPociuH.js";import{C as le,a as re,S as ie}from"./vue-tabler-icons.es-B6aNxJ30.js";import{_ as oe}from"./NavigationYear-BSkqyRnn.js";import{A as ce}from"./AppPageContent-Cgu7BwA4.js";const B=U({id:"user",state:()=>({savings:0,intersectionThreeDays:0,intersectionTenDays:0,maxSavingsPerDay:0,costsAll:0,costsSpent:0,costsOpen:0,activeTreat:{},inpaymentsSum:0}),getters:{available:e=>e.savings+e.inpaymentsSum-e.costsSpent,activeReached(e){return e.activeTreat.unlocked!==null?1:Math.min(1,this.available/e.activeTreat.costs)},activeRest(e){return Math.max(0,e.activeTreat.costs-this.available)},activeEtaThreeDays(e){return Math.ceil(this.activeRest/e.intersectionThreeDays)},activeEtaTenDays(e){return Math.ceil(this.activeRest/e.intersectionTenDays)},activeEtaMax(e){return Math.ceil(this.activeRest/e.maxSavingsPerDay)},openEtaThreeDays(e){return Math.ceil((e.costsOpen-e.available)/e.intersectionThreeDays)},openEtaTenDays(e){return Math.ceil((e.costsOpen-e.available)/e.intersectionTenDays)},openEtaMax(e){return Math.ceil((e.costsOpen-e.available)/e.maxSavingsPerDay)},hasActiveTreat:e=>e.activeTreat&&Object.keys(e.activeTreat).length!==0,canUnlock(e){return this.hasActiveTreat&&this.available>=e.activeTreat.costs}},actions:{async fetch(){const e=await x.get("/api/user");this.savings=e.data.savings,this.intersectionThreeDays=e.data.intersectionThreeDays,this.intersectionTenDays=e.data.intersectionTenDays,this.maxSavingsPerDay=e.data.maxSavingsPerDay,this.costsAll=e.data.costsAll,this.costsSpent=e.data.costsSpent,this.costsOpen=e.data.costsOpen,this.activeTreat=e.data.activeTreat,this.inpaymentsSum=e.data.inpaymentsSum},async setActiveTreat(e){await x.post(`/api/activetreat/${e.id}`),await this.fetch()},async removeActiveTreat(){await x.delete("/api/activetreat"),await this.fetch()},async unlock(){await x.post("/api/unlock/"+this.activeTreat.id),await this.fetch()}}}),W=U({id:"deedlogs",state:()=>({deedlogs:[]}),actions:{async fetchAll(){const e=await x.get("/api/deedlogs");e!==void 0&&(this.deedlogs=e.data)},async store(e){await x.post("/api/deedlogs",e)},async destroy(e){await x.delete(`/api/deedlogs/${e}`)}}}),de={class:"flex items-center"},ue=["checked"],ve={__name:"DeedsCheckbox",props:{deed:{type:Object,required:!0},date:{type:String,required:!0}},setup(e){const t=e,n=W(),c=B(),v=()=>{var d;return((d=n.deedlogs[t.date])==null?void 0:d[t.deed.id])!==void 0},h=async(d,m)=>{v()?await n.destroy(n.deedlogs[m][d.id].id):await n.store({deed_id:d.id,day:m}),await n.fetchAll(),await c.fetch()},p=`checkbox_${t.date}_${t.deed.id}`;return(d,m)=>(o(),f("div",de,[s("input",{id:p,type:"checkbox",class:"w-6 h-6 opacity-0 absolute",checked:v(),onChange:m[0]||(m[0]=P=>h(e.deed,e.date))},null,40,ue),m[1]||(m[1]=Q('<div class="border-2 rounded-md border-gray-400 dark:bg-gray-700 dark:border-gray-600 w-6 h-6 flex items-center justify-center"><svg class="fill-current hidden w-4 h-4 text-teal-600 pointer-events-none" viewBox="0 0 17 12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g transform="translate(-9 -11)" fill="currentColor" fill-rule="nonzero"><path d="m25.576 11.414c0.56558 0.55188 0.56558 1.4439 0 1.9961l-9.404 9.176c-0.28213 0.27529-0.65247 0.41385-1.0228 0.41385-0.37034 0-0.74068-0.13855-1.0228-0.41385l-4.7019-4.588c-0.56584-0.55188-0.56584-1.4442 0-1.9961 0.56558-0.55214 1.4798-0.55214 2.0456 0l3.679 3.5899 8.3812-8.1779c0.56558-0.55214 1.4798-0.55214 2.0456 0z"></path></g></g></svg></div>',1)),s("label",{for:p,class:"ml-2 font-medium text-gray-900 dark:text-gray-300"},r(e.deed.name),1)]))}},he={class:"flex justify-between"},fe={class:"space-y-2"},ge={key:0,class:"px-1 py-1 text-left text-xs dark:text-gray-400 text-center",style:{"writing-mode":"tb-rl"}},I={__name:"DeedsRow",props:{showDate:{type:Boolean,default:!0},date:{type:String,required:!0}},setup(e){const t=G();return(n,c)=>(o(),f("div",he,[s("div",fe,[(o(!0),f(S,null,L(a(t).deeds,v=>(o(),T(ve,{date:e.date,deed:v},null,8,["date","deed"]))),256))]),e.date!==null&&e.date!==""&&e.showDate===!0?(o(),f("div",ge,r(a(z)(e.date)),1)):$("",!0)]))}},me={class:"block mr-1"},j={__name:"ToggableContent",props:{labelMore:{type:String,default:"Mehr anzeigen"},labelLess:{type:String,default:"Weniger anzeigen"}},setup(e){const t=e,n=O(!1),c=M(()=>n.value===!0?le:re),v=M(()=>n.value===!0?t.labelLess:t.labelMore),h=()=>n.value=!n.value;return(p,d)=>(o(),f(S,null,[n.value?R(p.$slots,"default",{key:0}):$("",!0),s("a",{onClick:h,class:"mt-1 flex w-full items-center py-1 text-sm text-gray-500 dark:text-gray-400 select-none"},[s("span",me,r(v.value),1),(o(),T(X(c.value),{class:"w-5 h-5 text-gray-400"}))])],64))}},ye={class:"flex"},pe={class:"p-2 font-bold flex-1 mx-1"},_e={class:"space-y-6 mt-4"},A=11,C=0,be={__name:"DeedlogCalendar",setup(e){const t=new Date,n=O(t.getMonth()),c=O(t.getFullYear()),v=M(()=>n.value-1<C?A:n.value-1),h=M(()=>n.value+1>A?C:n.value+1),p=M(()=>n.value===t.getMonth()&&c.value===t.getFullYear()?J():K(n.value,c.value)),d=()=>{if(n.value+1>A){n.value=C,c.value++;return}n.value++},m=()=>{if(n.value-1<C){n.value=A,c.value--;return}n.value--};return(P,b)=>(o(),f(S,null,[s("div",ye,[s("button",{onClick:m,class:"p-2 block flex-1"}," « "+r(a(V)(v.value)),1),s("button",pe,r(a(V)(n.value)),1),s("button",{onClick:d,class:"p-2 flex-1"},r(a(V)(h.value))+" » ",1)]),i(oe,{modelValue:c.value,"onUpdate:modelValue":b[0]||(b[0]=g=>c.value=g)},null,8,["modelValue"]),s("div",_e,[(o(!0),f(S,null,L(p.value.slice(0,3),g=>(o(),T(I,{key:g,date:g},null,8,["date"]))),128)),i(j,null,{default:u(()=>[(o(!0),f(S,null,L(p.value.slice(3),g=>(o(),T(I,{key:g,date:g},null,8,["date"]))),128))]),_:1})])],64))}},xe={},Te={class:"font-semibold uppercase border-b text-xs text-gray-500 dark:text-gray-400 border-gray-100 dark:border-gray-800 pb-1 mb-5 select-none"};function De(e,t){return o(),f("div",Te,[R(e.$slots,"default")])}const E=Y(xe,[["render",De]]),we={class:"flex items-end mb-4"},ke=["onClick"],Se={class:"ml-2 flex-1"},$e={class:"text-xs text-gray-500 dark:text-gray-400"},Me={class:""},q={__name:"DashboardTreatList",props:{treats:{type:Object,required:!0}},setup(e){const t=B(),n=h=>t.hasActiveTreat&&h.id===t.activeTreat.id,c=h=>n(h)?"text-yellow-600":"text-gray-400",v=h=>{n(h)?t.removeActiveTreat():t.setActiveTreat(h)};return(h,p)=>(o(!0),f(S,null,L(e.treats,d=>(o(),f("div",we,[s("button",{onClick:m=>v(d),class:"pt-2 pr-1 select-none outline-0"},[i(a(ie),{class:Z(c(d))},null,8,["class"])],8,ke),s("div",Se,[s("div",$e,r(a(z)(d.bought)),1),s("div",Me,r(d.name),1)]),s("div",null,r(a(y)(d.costs)),1)]))),256))}},Ae={class:"py-1 flex justify-between text-base"},Ce={class:"font-semibold"},k={__name:"DashboardRow",props:{label:{type:String,required:!0}},setup(e){return(t,n)=>(o(),f("div",Ae,[s("div",null,r(e.label),1),s("div",Ce,[R(t.$slots,"default")])]))}},Ee={},He={class:"bg-white dark:bg-gray-700 text-black dark:text-gray-100 mx-2 py-2 px-3 rounded-md"};function Le(e,t){return o(),f("div",He,[R(e.$slots,"default")])}const H=Y(Ee,[["render",Le]]),Oe={class:"relative"},Re={class:"mt-1 w-full bg-gray-200 dark:bg-gray-900 rounded-full h-6 text-center"},Pe={class:"w-full h-6 flex items-center justify-center absolute top-0 left-0 text-xs text-center text-black dark:text-gray-200 font-bold"},Ve={__name:"ProgressBar",props:{percent:{type:Number,required:!0}},setup(e){const t=n=>{let c=.05;return n>.05&&(c=n),N(c)};return(n,c)=>(o(),f("div",Oe,[s("div",Re,[s("div",{class:"bg-teal-400 dark:bg-teal-700 h-6 rounded-full",style:ee({width:t(e.percent)})},null,4)]),s("div",Pe,r(a(N)(e.percent)),1)]))}},Ie={class:"mt-3 flex justify-between items-center"},je={class:"text-xl font-semibold text-teal-500"},ze={class:"flex justify-between text-base"},Be={key:0},Ne={class:"mt-4"},Fe={class:"w-full mt-4 mb-4"},qe={class:"text-right"},Ue=["innerHTML"],Ye=["innerHTML"],Ge={class:"text-right"},We=["innerHTML"],Je=["innerHTML"],Ke={class:"text-right"},Qe=["innerHTML"],Xe=["innerHTML"],Ze={class:"mt-4"},ot={__name:"PageDashboard",setup(e){const t=B(),n=G(),c=W(),v=ae(),h=ne(),p=te();let d=O(F(new Date().toISOString()));const m=async D=>{d.value=F(new Date().toISOString()),await t.fetch(),await n.fetchAll(),await c.fetchAll(),await v.fetchAll(),await h.fetchAll()},P=async()=>{await t.unlock(),await v.fetchAll()},b=D=>isFinite(D)?`${D} Tage`:"&infin;",g=D=>{let l=new Date;l.setDate(l.getDate()+D),p.show(z(l.toDateString()))};return se(async()=>{await m()}),document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&await m()}),(D,l)=>(o(),T(ce,{class:"pb-32"},{default:u(()=>[i(H,null,{default:u(()=>[i(E,null,{default:u(()=>l[7]||(l[7]=[_("Heute")])),_:1}),i(I,{date:a(d),"show-date":!1},null,8,["date"]),s("div",Ie,[l[8]||(l[8]=s("div",null,"Insgesamt verfügbar",-1)),s("div",je,r(a(y)(a(t).available)),1)])]),_:1}),a(t).hasActiveTreat?(o(),T(H,{key:0,class:"mt-6"},{default:u(()=>[i(E,null,{default:u(()=>l[9]||(l[9]=[_("Derzeit aktiv")])),_:1}),s("div",null,[s("div",ze,[s("div",null,r(a(t).activeTreat.name),1),s("div",null,r(a(y)(a(t).activeTreat.costs)),1)]),i(Ve,{percent:a(t).activeReached,class:"mt-3 mb-4"},null,8,["percent"]),a(t).canUnlock?(o(),f("div",Be,[s("button",{onClick:l[0]||(l[0]=w=>P()),class:"w-full text-center bg-gray-700 rounded-md text-white mb-4 py-2 font-semibold uppercase"}," Freischalten ")])):$("",!0),s("div",null,[i(k,{label:"Verbleibend"},{default:u(()=>[_(r(a(y)(a(t).activeRest)),1)]),_:1}),s("div",Ne,[i(j,null,{default:u(()=>[i(k,{label:"Kosten gesamt"},{default:u(()=>[_(r(a(y)(a(t).costsAll)),1)]),_:1}),i(k,{label:"Gespart gesamt"},{default:u(()=>[_(r(a(y)(a(t).savings)),1)]),_:1}),i(k,{label:"Einzahlungen"},{default:u(()=>[_(r(a(y)(a(t).inpaymentsSum)),1)]),_:1}),i(k,{label:"Ausgegeben"},{default:u(()=>[_(r(a(y)(a(t).costsSpent)),1)]),_:1}),i(k,{label:"Offen"},{default:u(()=>[_(r(a(y)(a(t).costsOpen)),1)]),_:1}),s("table",Fe,[l[13]||(l[13]=s("tr",null,[s("th"),s("th",{class:"text-right"},"Ø"),s("th",{class:"text-right"},"ETA (Aktuell)"),s("th",{class:"text-right"},"ETA (Rest)")],-1)),s("tr",null,[l[10]||(l[10]=s("td",null,"Maximal",-1)),s("td",qe,r(a(y)(a(t).maxSavingsPerDay)),1),s("td",{class:"text-right",innerHTML:b(a(t).activeEtaMax),onClick:l[1]||(l[1]=w=>g(a(t).activeEtaMax))},null,8,Ue),s("td",{class:"text-right",innerHTML:b(a(t).openEtaMax),onClick:l[2]||(l[2]=w=>g(a(t).openEtaMax))},null,8,Ye)]),s("tr",null,[l[11]||(l[11]=s("td",null,"3-Tage",-1)),s("td",Ge,r(a(y)(a(t).intersectionThreeDays)),1),s("td",{class:"text-right",innerHTML:b(a(t).activeEtaThreeDays),onClick:l[3]||(l[3]=w=>g(a(t).activeEtaThreeDays))},null,8,We),s("td",{class:"text-right",innerHTML:b(a(t).openEtaThreeDays),onClick:l[4]||(l[4]=w=>g(a(t).openEtaThreeDays))},null,8,Je)]),s("tr",null,[l[12]||(l[12]=s("td",null,"10-Tage",-1)),s("td",Ke,r(a(y)(a(t).intersectionTenDays)),1),s("td",{class:"text-right",innerHTML:b(a(t).activeEtaTenDays),onClick:l[5]||(l[5]=w=>g(a(t).activeEtaTenDays))},null,8,Qe),s("td",{class:"text-right",innerHTML:b(a(t).openEtaTenDays),onClick:l[6]||(l[6]=w=>g(a(t).openEtaTenDays))},null,8,Xe)])])]),_:1})])])])]),_:1})):$("",!0),i(H,{class:"mt-6"},{default:u(()=>[i(E,null,{default:u(()=>l[14]||(l[14]=[_("Treats")])),_:1}),s("div",Ze,[i(q,{treats:a(v).unlockableTreats.slice(0,3)},null,8,["treats"]),a(v).unlockableTreats.length>3?(o(),T(j,{key:0},{default:u(()=>[i(q,{treats:a(v).unlockableTreats.slice(3)},null,8,["treats"])]),_:1})):$("",!0)])]),_:1}),i(H,{class:"mt-6"},{default:u(()=>[i(E,null,{default:u(()=>l[15]||(l[15]=[_("Historie")])),_:1}),i(be)]),_:1})]),_:1}))}};export{ot as default};
