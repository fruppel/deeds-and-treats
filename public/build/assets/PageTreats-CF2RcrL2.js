import{m as D,n as h,r as S,k as f,o as c,e as t,f as o,i as g,B as T,c as F,A as I,q as C,t as w,w as y,g as b,x as O,C as P,a as B,F as j,s as R}from"./app-fm232Leb.js";import{A as z}from"./AppPageContent-Cgu7BwA4.js";import{u as K}from"./treats-dqNdb7dL.js";import{F as k}from"./FormLabel-B22naSZF.js";import{_ as $,a as V}from"./FormError-mP4jGLzB.js";import{M as H,P as J}from"./vue-tabler-icons.es-B6aNxJ30.js";import{g as U,f as Q}from"./formatting-service-CQyrWaM7.js";import{_ as W}from"./FloatingActionButton-w2P_xo-Y.js";import{_ as A}from"./FormSelect-QFHuBrV2.js";const G=D({id:"treatsFiltered",state:()=>({treats:[],sort:{by:null,direction:null},filter:null}),getters:{combinedSort(){return this.sort.by!==null&&this.sort.direction!==null?`${this.sort.by}_${this.sort.direction}`:null}},actions:{async fetch(){const e=await h.get("/api/treats",{params:{sortBy:this.sort.by,sortDirection:this.sort.direction,filter:this.filter}});e!==void 0&&(this.treats=e.data)},async applySort(e,s){this.sort.by=e,this.sort.direction=s,await this.fetch()},async applyFilter(e){this.filter=e,await this.fetch()}}}),q=D({id:"treat",state:()=>({treat:null,errors:{}}),actions:{async fetchById(e){const{data:s}=await h.get(`/api/treats/${e}`);this.treat=s.treat},async update(e){try{await h.patch(`/api/treats/${e.id}`,e)}catch(s){throw this.errors=s.response.data.errors,s}},async store(e){try{await h.post("/api/treats",e)}catch(s){throw s.response.data.errors&&(this.errors=s.response.data.errors),s}},async destroy(e){await h.delete(`/api/treats/${e}`)},async divide(e,s){try{return await h.post(`/api/treat/divide/${e}`,{divideInto:s}),!0}catch(a){return a.response.data.errors&&(this.errors=a.response.data.errors),!1}}}}),X={class:"mt-4"},Y={class:"flex"},Z={__name:"TreatDivideForm",props:{id:{type:Number,required:!0}},emits:["divided"],setup(e,{emit:s}){const a=e,m=s,l=q(),r=S(2),d=()=>r.value++,_=()=>r.value--,i=async()=>{await l.divide(a.id,r.value)===!0&&m("divided")};return(p,u)=>(c(),f("div",null,[u[3]||(u[3]=t("h2",{class:"uppercase font-semibold text-gray-900"}," Treat aufteilen ",-1)),t("div",X,[t("div",Y,[t("button",{onClick:u[0]||(u[0]=x=>_()),class:"bg-gray-100 px-3 rounded-l-md"},[o(g(H))]),o($,{class:"rounded-none border-0 text-center",modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=x=>r.value=x)},null,8,["modelValue"]),t("button",{onClick:u[2]||(u[2]=x=>d()),class:"bg-gray-100 px-3 rounded-r-md"},[o(g(J))])]),o(V,{error:g(l).errors.divideInto},null,8,["error"]),t("button",{onClick:i,type:"button",class:"w-full mt-4 bg-gray-800 text-white py-2 px-2 rounded-md text-sm uppercase font-semibold"}," Aufteilen ")])]))}},ee={class:"px-4 py-4"},te={class:"uppercase font-semibold text-gray-900"},se={class:"mt-4"},re={class:"mt-4"},ae={class:"mt-4"},oe={class:"mt-4"},le={key:0,class:"mt-8 pt-6 border-t border-gray-400"},ne={key:1,class:"mt-8 pt-6 border-t border-gray-600"},E={__name:"TreatsForm",props:{id:{type:Number,default:null}},setup(e){const s=K(),a=q(),m=T(),l=e,r=S({id:l.id,name:null,costs:null,bought:null,unlocked:null}),d=F(()=>a.errors),_=F(()=>p()?"Treat bearbeiten":"Treat erstellen"),i=async()=>{m.close(),await s.fetchAll()},p=()=>l.id!==void 0&&l.id!==null,u=F(()=>p()&&a.treat&&a.treat.unlocked!==null),x=async()=>{p()===!0?await a.update(r.value):await a.store(r.value),await i()},L=async()=>{await a.destroy(l.id),await i()},M=async()=>{await a.fetchById(l.id),r.value.id=a.treat.id,r.value.name=a.treat.name,r.value.costs=a.treat.costs,r.value.bought=a.treat.bought,r.value.unlocked=a.treat.unlocked},N=S(!1);return I(async()=>{p()&&(await M(),N.value=u.value===!1)}),(ge,n)=>(c(),f("div",ee,[t("div",null,[t("h2",te,w(_.value),1),t("div",se,[o(k,null,{default:y(()=>n[4]||(n[4]=[b("Name")])),_:1}),o($,{modelValue:r.value.name,"onUpdate:modelValue":n[0]||(n[0]=v=>r.value.name=v)},null,8,["modelValue"]),o(V,{error:d.value.name},null,8,["error"])]),t("div",re,[o(k,null,{default:y(()=>n[5]||(n[5]=[b("Kosten")])),_:1}),o($,{modelValue:r.value.costs,"onUpdate:modelValue":n[1]||(n[1]=v=>r.value.costs=v)},null,8,["modelValue"]),o(V,{error:d.value.costs},null,8,["error"])]),t("div",ae,[o(k,null,{default:y(()=>n[6]||(n[6]=[b("Gekauft")])),_:1}),o($,{type:"date",modelValue:r.value.bought,"onUpdate:modelValue":n[2]||(n[2]=v=>r.value.bought=v)},null,8,["modelValue"]),o(V,{error:d.value.bought},null,8,["error"])]),t("div",oe,[o(k,null,{default:y(()=>n[7]||(n[7]=[b("Freigeschaltet")])),_:1}),o($,{type:"date",modelValue:r.value.unlocked,"onUpdate:modelValue":n[3]||(n[3]=v=>r.value.unlocked=v)},null,8,["modelValue"]),o(V,{error:d.value.unlocked},null,8,["error"])]),t("div",{class:"mt-6 flex"},[t("button",{onClick:i,type:"button",class:"w-1/2 mr-1 border border-gray-300 rounded-md bg-gray-400 text-gray-800 text-sm uppercase font-semibold"}," Abbrechen "),t("button",{onClick:x,type:"button",class:"w-1/2 bg-teal-500 text-white py-2 px-2 rounded-md text-sm uppercase font-semibold"}," Speichern ")])]),N.value?(c(),f("div",le,[o(Z,{id:r.value.id,onDivided:i},null,8,["id"])])):C("",!0),u.value===!1?(c(),f("div",ne,[n[8]||(n[8]=t("h2",{class:"uppercase font-semibold text-gray-900 mb-2"}," Treat löschen ",-1)),t("button",{onClick:L,class:"w-full bg-red-900 text-white py-2 px-2 rounded-md text-sm uppercase font-semibold"}," Löschen ")])):C("",!0)]))}},ie={class:"flex"},de={class:"flex-1"},ue={class:"text-xs text-gray-400 dark:text-gray-400"},ce={key:0},me={class:"font-semibold"},pe={class:"flex justify-between dark:text-gray-100"},fe={__name:"TreatsRow",props:{treat:{type:Object,required:!0}},setup(e){const s=e,a=T(),m=async()=>{a.open(P(E),{id:s.treat.id})},l=F(()=>s.treat.unlocked!==null);return(r,d)=>(c(),f("div",{onClick:m,class:"pt-2 pr-2 last:pb-2"},[t("div",ie,[t("span",{class:O(["ml-1 w-1.5 mr-2",{"bg-teal-600":l.value}])},null,2),t("div",de,[t("div",ue,[t("div",null,"Gekauft: "+w(g(U)(e.treat.bought)),1),l.value?(c(),f("div",ce,[d[0]||(d[0]=b(" Freigeschaltet: ")),t("span",me,w(g(U)(e.treat.unlocked)),1)])):C("",!0)]),t("div",pe,[t("div",null,w(e.treat.name),1),t("div",null,w(g(Q)(e.treat.costs)),1)])])])]))}},ve={class:"mt-4"},ye={__name:"TreatsFilter",setup(e){const s=G(),a={name_asc:"Name (aufsteigend)",name_desc:"Name (absteigend)",bought_asc:"Gekauft (aufsteigend)",bought_desc:"Gekauft (absteigend)",costs_asc:"Preis (aufsteigend)",costs_desc:"Preis (absteigend)",unlocked_asc:"Freigeschaltet (aufsteigend)",unlocked_desc:"Freigeschaltet (absteigend)"},m={all:"Alle",unlocked:"Freigeschaltet",not_unlocked:"Nicht freigeschaltet"},l=S({sort:s.combinedSort??"bought_asc",filter:s.filter??"all"}),r=()=>{let[_,i]=l.value.sort.split("_");s.applySort(_,i)},d=()=>s.applyFilter(l.value.filter);return(_,i)=>(c(),f("div",null,[t("div",null,[o(k,{class:"dark:text-gray-300"},{default:y(()=>i[2]||(i[2]=[b("Sortieren")])),_:1}),o(A,{options:a,onChange:r,modelValue:l.value.sort,"onUpdate:modelValue":i[0]||(i[0]=p=>l.value.sort=p)},null,8,["modelValue"])]),t("div",ve,[o(k,{class:"dark:text-gray-300"},{default:y(()=>i[3]||(i[3]=[b("Filter")])),_:1}),o(A,{options:m,onChange:d,modelValue:l.value.filter,"onUpdate:modelValue":i[1]||(i[1]=p=>l.value.filter=p)},null,8,["modelValue"])])]))}},be={class:"space-y-2 divide-y bg-white dark:bg-gray-700 border dark:border-gray-900 dark:divide-gray-900 shadow rounded-md"},Ce={__name:"PageTreats",setup(e){const s=T(),a=G(),m=()=>s.open(P(E));return I(async()=>{await a.fetch()}),(l,r)=>(c(),B(z,{class:"px-4 pb-32"},{default:y(()=>[o(ye,{class:"mb-8"}),t("div",be,[(c(!0),f(j,null,R(g(a).treats,d=>(c(),B(fe,{treat:d},null,8,["treat"]))),256))]),o(W,{onClick:m})]),_:1}))}};export{Ce as default};
